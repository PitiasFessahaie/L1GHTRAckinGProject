     1: /* Main.c file generated by New Project wizard
     2:  *light traking robot
     3:  * Created:   ??? MAY 2012
     4:  * Processor: PIC16F84A
     5:  * Compiler:  HI-TECH C for PIC10/12/16
     6:  */
     7: 
     8: 
     9: #include<htc.h>
    10: __CONFIG(0x3FF1);
    11: #define PORTBIT(adr, bit)       ((unsigned)(&adr)*8+(bit))
    12: static bit LD1 @ PORTBIT(PORTB,2);
    13: static bit LD2 @ PORTBIT(PORTB,3);
    14: static bit SIGIO @ PORTBIT(PORTB,4);
    15: #define STRIS TRISBbits.TRISB4            //Defines STRIS as TRISB pin 4
    16: void init(void)
    17: {     
    18: TRISB=0b00001100;
    19: }
    20: unsigned int i;
    21: void forward();
    22: void right();
    23: void left();
    24: void halt();
    25: 
    26: void main(void)
    27: { unsigned int EchoTime=0, Distance=0;
    28: init();
    29: while(1)
    30: {SIGIO=0;          //SET SIGNAL TO LOW
    31:  STRIS=0;
    32: SIGIO=1;
    33: __delay_us(10);
    34: SIGIO=0;          //waiting for T-hold period
    35: STRIS=0;        
    36: __delay_us(700);
    37: STRIS=1;
    38: EchoTime=0;
    39: Distance=0;       //Clearing timer and distance 
    40: while(SIGIO==1){EchoTime++;}  //Start counting the Echo time
    41:         Distance=EchoTime/58;     // results Distance in ""cm"" 
    42: if((LD1==1)&&(LD2==1))                 
    43: {forward();}
    44: else if(LD1==1)
    45: {right();}
    46: else if(LD2==1)
    47: {left();}
    48: else halt();}}
    49: 
    50: void halt()
    51: {PORTB=0b00000000;
    52:         __delay_ms(1000);};
    53:         
    54: void forward()
    55: {PORTB=0b00000011;
    56: __delay_ms(1000); 
    57: };
    58: void right()
    59: {PORTB=0b00000001;
    60: __delay_ms(1000);};
    61: 
    62: void left()           
    63: {PORTB=0b00000010;
    64: __delay_ms(1000);};
